# Verstka JavaScript SDK

## Интеграция с CMS
Статьи созданные в **Verstka** представляют из себя HTML-код и файлы изображений.
JavaScript-SDK взаимодействует с сервером посредством multipart/form-data.

### Подключение SDK
Подключите скрипт:
```
<script src="//go.verstka.io/sdk/v2.js"></script>
```
SDK будет автоматически инициализирован, когда страница загрузится.

### Добавление в форму
Чтобы создать панель для редактирования материала, добавьте в форму CMS следующие элементы:
```
<xmp name="verstka" hidden>
  {
    'api_key': [api_key],
    'material_id': [material_id],
		'images_source': [images_source],
    'materials': {
      'desktop': [desktop],
      'mobile': [mobile]
    },
    'actions': [actions]
		'name': [name],
		'user_id': [user_id],
		'is_active': [is_active],
		'mobile_mode': [mobile_mode]
  }
</xmp>

<textarea hidden>[material_desktop]</textarea>
<textarea hidden>[material_mobile]</textarea>
```

Элемент `xmp` содержит настройки для данного материала:
* `api_key` – уникальный ключ, выдаваемый при интеграции.
* `material_id` – уникальный идентификатор материала.
* `actions` – обработчики событий.
* `images_source` – hostname, на котором будут храниться файлы изображений. По умолчанию, совпадает с hostname CMS. Изображения в материале имеют относительный путь и будут ссылаться на данный hostname.
* `name` – произвольное имя панели управления. Рекомендуем указывать для удобства отладки.
* `user_id` – уникальный идентификатор текущего пользователя. Указывайте, если хотите знать, какие пользователи редактировали материал.
* `is_active` – флаг, сообщающий о том, включена ли **Verstka** для данной страницы. Флаг используется в том случае, если CMS использует другие редакторы помимо **Verstka**.
* `mobile_mode` – способ отображения мобильной версии.
* `materials` – селекоторы элементов `textarea`, которые хранят содержимое статьи.

Элемент `textarea` является служебным, и может быть скрыт от пользователя.<br>
Если все параметры указаны верно, то при инициализации SDK в форме появится кнопка &laquo;**Edit with Verstka**&raquo; (сразу после элемента `textarea`).<br>
Данная кнопка открывает в новой вкладке редактор **Verstka**.

## Взаимодействие CMS с редактором **Verstka**
Все взаимодействия между CMS и редактором происходят автоматически, согласно параметрам, указанным в элементе `textarea`.

### Создание и редактирование статей
Создание и редактирование статей осуществляется посредством кнопки &laquo;**Edit with Verstka**&raquo;, которая открывает редактор **Verstka** в новой вкладке.

### Сохранение статей
После того, как статья будет сохранена в редакторе **Verstka**, SDK осуществит POST-запрос по адресу `save_url`, передав HTML-код статьи, идентификатор пользователя, идентификатор материала и файлы изображений в формате multipart/form-data.<br>
Ответ от сервера должен прийти в формате JSON:<br>
```
{
  content: [html]
}
```
При этом, поле `content` должно содержать обновленный HTML статьи.

## Отображение статей
Вывод HTML-кода статьи должен сопровождаться подключением скрипта:

```
<script type = "text/javascript">
  window.onVMSAPIReady = function( api ) {
    api.Article.enable( {
      [options]
    } );
  };
</script>
<script src="//go.verstka.io/api.js" async type="text/javascript"></script>
```

## Параметры `options`
Все параметры являются необязательными
* `display_mode` – переключает между режимами отображения статьи [`desktop` | `mobile`]
* `auto_mobile_detect` – автоматическое определение мобильных устройств по User Agent. Default: `true`
* `mobile_max_width` – ширина окна браузера, при которой происходит переключение между мобильной и десктопной версией статьи
* `observe_selector` – селекторы DOM-элементов, которые потенциально могут изменить положение статьи
